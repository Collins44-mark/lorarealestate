{% extends "lora_admin/base.html" %}
{% load lora_admin_extras %}

{% block content %}
<div class="page-header">
  <h1>Bookings</h1>
  <p class="page-subtitle">Viewing requests from the website. Contact guests directly via phone or WhatsApp.</p>
</div>

<div class="filter-bar bookings-filter">
  <form method="get" class="filter-form filter-form-inline" id="bookingsFilterForm">
    <div class="filter-group">
      <label for="status">Status</label>
      <select name="status" id="status" class="form-input form-select" onchange="this.form.submit()">
        <option value="">All</option>
        {% for val, label in status_choices %}
        <option value="{{ val }}" {% if status_filter == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
  </form>
</div>

<div class="bookings-list">
  {% for b in bookings %}
  <article class="booking-card">
    <div class="booking-card-section">
      <span class="booking-label">Guest</span>
      <strong>{{ b.full_name }}</strong>
      <small>{{ b.email }}</small>
      {% if b.phone %}<small class="text-phone">{{ b.phone }}</small>{% endif %}
    </div>
    <div class="booking-card-section">
      <span class="booking-label">Property</span>
      <a href="{% url 'lora_admin:property_detail' b.property_id %}">{{ b.property.title }}</a>
    </div>
    <div class="booking-card-section">
      <span class="booking-label">Date & Time</span>
      <span>{{ b.preferred_date }} {{ b.preferred_time }}</span>
    </div>
    <div class="booking-card-section">
      <span class="booking-label">Status</span>
      <form method="post" action="{% url 'lora_admin:booking_update_status' b.pk %}{% if status_filter %}?status={{ status_filter }}{% endif %}" class="booking-status-inline">
        {% csrf_token %}
        <input type="hidden" name="next_status_filter" value="{{ status_filter }}">
        <select name="status" class="form-input form-select form-select-sm" onchange="this.form.submit()">
          {% for val, label in status_choices %}
          <option value="{{ val }}" {% if b.status == val %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </form>
    </div>
    <div class="booking-card-section">
      <span class="booking-label">Contact</span>
      {% if b.phone %}
      <a href="tel:{{ b.phone }}" class="btn btn-sm btn-contact" title="Call">üìû Call</a>
      <a href="https://wa.me/{{ b.phone|phone_digits }}" class="btn btn-sm btn-whatsapp" target="_blank" rel="noopener" title="WhatsApp">WhatsApp</a>
      {% else %}
      <a href="mailto:{{ b.email }}" class="btn btn-sm btn-contact" title="Email">‚úâÔ∏è Email</a>
      {% endif %}
    </div>
    <div class="booking-card-section booking-actions">
      <span class="booking-label">Actions</span>
      <div class="booking-actions-btns">
        <a href="{% url 'lora_admin:booking_detail' b.pk %}" class="btn btn-sm btn-outline">View</a>
        <a href="{% url 'lora_admin:booking_delete' b.pk %}{% if status_filter %}?status={{ status_filter }}{% endif %}" class="btn btn-sm btn-outline btn-delete">Delete</a>
      </div>
    </div>
  </article>
  {% empty %}
  <div class="bookings-empty">No bookings yet. Visit requests from the website will appear here.</div>
  {% endfor %}
</div>
{% endblock %}
